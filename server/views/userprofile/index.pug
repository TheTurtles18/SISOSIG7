extends ../layout

block append content
  h2.page-header  User Page 
  div(div='div', ng-app='myApp', ng-controller='myCtrl')
    div
      #miniHeader
      h4 {{firstname}} 
      h4(ng-bind='lastname')
      h4(ng-bind='email')
    hr
    h3 My Posts
    div
      .row
      .card.col-md-3(ng-repeat='post in postArray' ng-if="post.FBid == 1")
        img.card-img-top(src='http://placehold.it/350x150')
        .card-block
          h3.card-title {{post.caption}}
          h5 {{post.createdAt | date: 'medium'}}
          #likeDislike
            h6.card-shaves {{post.shave_votes}}
            a.btn.like(ng-click="updatePost(post._id, 'shave')") Shave
            h6.card-grows {{post.grow_votes}}
            a.btn.dislike(ng-click="updatePost(post._id, 'grow')") Grow

    script.
      console.log("cookie kevin");
      console.log(getCookie("officialId"));
      var app = angular.module('myApp', []);
      app.controller('myCtrl', function($scope, $http) {
        //- console.log("hello user Id");
        //- console.log(getCookie("newCookie"));
        console.log("App Controller");
        $http({
          method : "GET",
          url : 'api/fblogged/'+getCookie("officialId")
        })
        .then(function(response) {
          $scope.firstname = response.data.First;
          console.log("Test body");
          console.log(response);
          console.log(response.data.First);
          $scope.lastname = response.data.Last;  
          $scope.username = response.data.Username;  
          $scope.email = response.data.Email;  
          
         });

        $scope.postArray = [];
        $scope.postLoader = function() {
          console.log("Josh test");
          $http.get('/api/posts/').then(function(response) {
            $scope.postArray = response.data
            console.log($scope.postArray.length);
          }).catch(function(err) {
            $log.debug(err);
          });
        }
        $scope.postLoader();

        $scope.updatePost = function(id, type) {
          console.log(id + " " + type);
          $http({
            method: 'PUT',
            url: 'api/post/'+id+'?type='+type}).then(function(response) {
              console.log("then");
            $scope.dummy = response.data;
            $scope.postLoader();
          }).catch(function(err) {
            console.log("catch");
            $log.debug(err);
          });
        }
      });